<html>
<head>
<title>WEBRTC SAMPLE VIDEO</title>
<script type='text/javascript' src='http://code.jquery.com/jquery-latest.min.js'></script>
<script type='text/javascript' src='https://cdn.firebase.com/js/client/1.0.11/firebase.js'></script>
<script type='text/javascript' src='adapter.js'></script>
<script type='text/javascript' src='functions.js'></script>
<script type='text/javascript' src='media.js'></script>
<script type='text/javascript' src='session.js'></script>
</head>
<body>
<script type="text/javascript">
	
if( !window.location.search.length ){		
		window.location.search = guid();
		return;
}

var g_local_id  = guid();
var g_iceCache  = [];
var g_peer_connection = createPeerConnection();
var g_session   = new Session( window.location.search, g_peer_connection );	


getUserMedia(pc_media_options, function (stream) {

		var video = document.getElementById("local_video_stream");
		video.src = URL.createObjectURL(stream);
		g_peer_connection.addStream( stream );		

		//ready to join session, all media is setup		
		g_session.join( g_local_id, true );
		
	}, pc_console_handler);



/*	
//-- generate random user 
var g_local_id = 'caller';	
var g_remote_id = 'callee';	
var g_iceCache = [];

//-- setup peer connection
var peer_connection	= createPeerConnection();

//-- firebase connections
var g_fb_session = createFireBaseSession( window.location.search );

//wait for other to join
g_fb_session.on( 'child_added', function( snapshot) {

	var incoming_user = snapshot.name();

	if( incoming_user == g_local_id ){
		//ignor call
		return;
	}
	
	if( g_remote_id != incoming_user )
	{
		//something wrong, ignore;
		return;
	}
	
	createOffer( peer_connection );	
});	

var g_fb_user = createFireBaseUser( g_fb_session, g_local_id );

//wait for awnsers
g_fb_user.child( 'answer' ).on( 'value', function( snapshot) {
		
		if( snapshot.val() === null ){
			return;
		}
		
		var desc = new RTCSessionDescription( JSON.parse( snapshot.val() ) );
		peer_connection.setRemoteDescription( desc );	
		
		publishIce();
		
});	

//wait for ice
g_fb_user.child( 'ice' ).on( 'value', function( snapshot) {
		
		if( snapshot.val() === null ){
			return;
		}
		
		var arr = JSON.parse( snapshot.val() );
	
		for ( var i = 0; i < arr.length; i = i + 1 ) {
			var ice = new RTCIceCandidate ( JSON.parse( arr[ i ] ) );
			peer_connection.addIceCandidate( ice );
		}
		
});	

//-- start local video and audio
startVideo( peer_connection );
*/
</script>	

	<div id="local_video">
		<video id="local_video_stream" controls  autoplay></video>
	</div>

	<div id="remote_video">
		<video id="remote_video_stream" controls  autoplay></video>
	</div>
	
</body>
</html>